<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link rel="stylesheet" href="styles.css">
    <title>Modern Chat Room</title>
    
    <style>
        body {
          font-family: "Lato", sans-serif;
        }
        
        .sidenav {
          width: 130px;
          position: fixed;
          z-index: 1;
          top: 20px;
          left: 10px;
          background: #eee;
          overflow-x: hidden;
          padding: 8px 0;
        }
        
        .sidenav a {
          padding: 6px 8px 6px 16px;
          text-decoration: none;
          font-size: 25px;
          color: #2196F3;
          display: block;
        }

        .sidenav a:hover {
          color: #064579;
        }
        
        .main {
          margin-left: 140px; /* Same width as the sidebar + left position in px */
          font-size: 28px; /* Increased text to enable scrolling */
          padding: 0px 10px;
        }
        
        @media screen and (max-height: 450px) {
          .sidenav {padding-top: 15px;}
          .sidenav a {font-size: 18px;}
        }

           body {
            display: flex;
            height: 100vh;
            margin: 0;
            font-family: Arial, sans-serif;
            background-color: #ffffff;
        }

        .sidebar {
            width: 300px;
            background-color: #ffffff;
            border-right: 1px solid #313131;
            overflow-y: auto;
            display: fixed;
            color: black;
            
            
        }

        .sidebar h2 {
            font-size: 18px;
            font-weight: bold;
            padding: 20px;
            margin: 0;
        }

        .sidebar button {
            display: block;
            width: 100%;
            border-radius: 0%;
            padding: 15px 20px;
            background: none;
            border: none;
            text-align: center;
            cursor: pointer;
            color: black;
        }

        .sidebar button:hover {
            background-color: #a3a3a37c;
            border-radius: 0%;
            border-color: black;
            width: 100%;
        }

        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            scrollbar-color: white;
        }

        .chat-header {
            margin-right: 0px;
            width: 100%;
            background-color: #f5f5f5;
            padding: 15px;
            border-bottom: 1px solid #e0e0e0;
        }
        body {
  font-family: "Lato", sans-serif;
}

.sidenav {
  height: 100%;
  width: 0;
  position: fixed;
  z-index: 1;
  top: 0;
  left: 0;
  background-color: #111;
  overflow-x: hidden;
  transition: 0.5s;
  padding-top: 60px;
}

.sidenav a {
  padding: 8px 8px 8px 32px;
  text-decoration: none;
  font-size: 25px;
  color: #818181;
  display: block;
  transition: 0.3s;
}

.sidenav a:hover {
  color: #f1f1f1;
}

.sidenav .closebtn {
  position: absolute;
  top: 0;
  right: 25px;
  font-size: 36px;
  margin-left: 50px;
}

#main {
  transition: margin-left .5s;
  padding: 16px;
}

@media screen and (max-height: 450px) {
  .sidenav {padding-top: 15px;}
  .sidenav a {font-size: 18px;}
}
        .chat-header h2 {
            font-size: 18px;
            margin: 0;
        }

        .chat-window {
            flex: 1;
            display: flex;
            flex-direction: column;
            background-color: #ffffff;
            padding: 20px;
            overflow-y: auto;
        }

        .chat-window .placeholder {
            color: #b0b0b0;
            font-size: 18px;
            text-align: center;
            margin: auto;
        }

        .chat-window ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .chat-window li {
            max-width: 10%;
            margin: 10px 0;
            padding: 10px 15px;
            border-radius: 20px;
        }

        .chat-window .sender {
            margin-left: auto;
            background-color: #007bff;
            color: white;
        }

        .chat-window .receiver {
            background-color: #e0e0e0;
        }

        .chat-input {
            display: flex;
            padding: 0px 0px;
            background-color: #ffffff;
            border-top: 1px solid #e0e0e0;
        }

        .chat-input input {
            flex: 1;
            padding: 10px;
            border-radius: 20px;
            border: 1px solid #404444;
        }

        .chat-input button {
            margin-left: 0px;
            padding: 10px 20px;
            border-radius: 20px;
            background-color: #007bff;
            color: white;
            border: none;
            cursor: pointer;
        }
    </style>
</head>
<body>
    
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <h2>Chat Rooms</h2>
        <button class="btn btn-outline-light" id="5th-grade">5th Grade</button>
        <button class="btn btn-outline-light" id="6th-grade">6th Grade</button>
        <button class="btn btn-outline-light" id="7th-grade">7th Grade</button>
        <button class="btn btn-outline-light" id="8th-grade">8th Grade</button>
    </div>

    <div class="container" id="container">
        <!-- Chat Header -->
        <div class="chat-header">
            <span id="chat-room-name">Select a conversation to get started</span> <!-- Default text -->
        </div>

        <!-- Chat Window -->
        <div class="chat-window">
            <div id="chat-placeholder" class="empty-chat"></div>
            <ul class="chat-list" id="chat-list" style="display: none;"></ul> <!-- Hide chat list until conversation is selected -->
        </div>

        <!-- Chat Input Box -->
        <div class="chat-input">
            <input type="text" id="message" placeholder="Type your message..." required>
            <button id="send-btn">Send</button>
            <button id="banButton" onclick="banUserPrompt();">Ban User</button>
            <button id="clear-chat-btn" onclick="clearChat();">Clear Chat</button>
        </div>
    </div>

    <script src="http://cdn.date-fns.org/v1.9.0/date_fns.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.9.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.9.1/firebase-firestore.js"></script>
    <script>
        // Initialize Firebase
        const config = {
            apiKey: "AIzaSyBrmCxCrbYatKbnkMtYw1T2xT3-ZZ9M2-E",
            authDomain: "javascript-b4fbd.firebaseapp.com",
            projectId: "javascript-b4fbd",
            storageBucket: "javascript-b4fbd.appspot.com",
            messagingSenderId: "1",
            appId: "1:186154721970:web:edd9514de86c1080c39fab",
            measurementId: "G-5DR8GPNCVL"
        };
        firebase.initializeApp(config);
        const db = firebase.firestore();

        let currentChatroom = null; // No default chatroom

        // Prompt for username on page load
        window.onload = function () {
            let username = sessionStorage.getItem('username');

            if (!username) {
                username = prompt("Please enter your username:");
                if (username) {
                    sessionStorage.setItem('username', username);
                    alert(`Welcome, ${username}!`);
                } else {
                    alert("A username is required to use the chatroom.");
                    location.reload();
                }
            } else {
                alert(`Welcome back, ${username}!`);
            }
        };

        // Load messages for the selected chatroom
        function loadMessages() {
            const chatList = document.getElementById('chat-list');
            const chatPlaceholder = document.getElementById('chat-placeholder');
            chatList.style.display = 'block'; // Show chat list
            chatPlaceholder.style.display = 'none'; // Hide placeholder text

            chatList.innerHTML = ''; // Clear chat list

            db.collection(currentChatroom)
                .orderBy('timestamp', 'asc')
                .onSnapshot(snapshot => {
                    chatList.innerHTML = ''; // Clear chat list before updates
                    snapshot.forEach(doc => {
                        const messageData = doc.data();
                        const messageItem = document.createElement('li');
                        messageItem.className = 
                            messageData.username === sessionStorage.getItem('username') ? 
                            'sender' : 'receiver';
                        messageItem.textContent = `${messageData.username}: ${messageData.message}`;
                        chatList.appendChild(messageItem);
                        
                    });
                });
        }

        // Send message
        document.getElementById('send-btn').addEventListener('click', () => {
            const messageInput = document.getElementById('message');
            const message = messageInput.value.trim();

            if (message && currentChatroom) {
                const username = sessionStorage.getItem('username');
                db.collection(currentChatroom).add({
                    username: username,
                    message: message,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                }).then(() => {
                    messageInput.value = ''; // Clear input
                }).catch(err => console.error('Error sending message:', err));
            }


});
        
        
        

        // Clear chat button functionality
        document.getElementById('clear-chat-btn').addEventListener('click', () => {
            if (currentChatroom) {
                db.collection(currentChatroom).get().then(snapshot => {
                    snapshot.forEach(doc => {
                        doc.ref.delete(); // Delete each message
                    });
                }).then(() => {
                    location.reload(); // Refresh the page
                }).catch(err => console.error('Error clearing chat:', err));
            }
        });

        // Event listeners for grade buttons
        document.getElementById('5th-grade').addEventListener('click', () => {
            currentChatroom = "5th-grade"; // Change chatroom
            loadMessages(); // Reload messages for the new chatroom
            highlightActiveButton('5th-grade');
            updateChatHeader('5th Grade');
            hideSidebar(); // Hide sidebar completely
            function scrollToBottom() {
            window.scrollTo(0, document.body.scrollHeight);
        }
        history.scrollRestoration = "manual";
        window.onload = scrollToBottom;
        });

        document.getElementById('6th-grade').addEventListener('click', () => {
            currentChatroom = "6th-grade"; // Change chatroom
            loadMessages(); // Reload messages for the new chatroom
            highlightActiveButton('6th-grade');
            updateChatHeader('6th Grade');
            hideSidebar(); // Hide sidebar completely
            function scrollToBottom() {
            window.scrollTo(0, document.body.scrollHeight);
        }
        history.scrollRestoration = "manual";
        window.onload = scrollToBottom;
        });

        document.getElementById('7th-grade').addEventListener('click', () => {
            currentChatroom = "7th-grade"; // Change chatroom
            loadMessages(); // Reload messages for the new chatroom
            highlightActiveButton('7th-grade');
            updateChatHeader('7th Grade');
            hideSidebar(); // Hide sidebar completely
            function scrollToBottom() {
            window.scrollTo(0, document.body.scrollHeight);
        }
        history.scrollRestoration = "manual";
        window.onload = scrollToBottom;
        });

        document.getElementById('8th-grade').addEventListener('click', () => {
            currentChatroom = "8th-grade"; // Change chatroom
            loadMessages(); // Reload messages for the new chatroom
            highlightActiveButton('8th-grade');
            updateChatHeader('8th Grade');
            hideSidebar(); // Hide sidebar completely
            function scrollToBottom() {
            window.scrollTo(0, document.body.scrollHeight);
        }
        history.scrollRestoration = "manual";
        window.onload = scrollToBottom;
        });

        // Function to hide the sidebar completely
        function hideSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.add('collapsed');
            document.getElementById('container').classList.add('fullscreen'); // Make fullscreen
        }

        // Function to highlight the active button
        function highlightActiveButton(grade) {
            const buttons = document.querySelectorAll('.sidebar button');
            buttons.forEach(button => {
                button.classList.remove('active');
            });
            document.getElementById(grade).classList.add('active');
        }

        // Function to update the chat header dynamically
        function updateChatHeader(groupName) {
            document.getElementById('chat-room-name').textContent = groupName;
        }

        // Sidebar toggle functionality
        document.getElementById('hamburger').addEventListener('click', () => {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('collapsed');
            document.getElementById('container').classList.toggle('fullscreen'); // Toggle fullscreen on container
        });
        



    </script>
</body>
</html>
